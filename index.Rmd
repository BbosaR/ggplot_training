---
title: "DATA VISUALIZATION TRAINING with R"
subtitle: "âš”<br/>ggplot2"
author: "UI-LISA Collaborators"
institute: "Laboratory for Interdisciplinary Statistical Analysis(UI-LISA), Department of Statistics,University of Ibadan"
date: "2016/12/12 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    css: ["default", "chocolate", "rladies-fonts"]
    lib_dir: libs
    seal: false
    nature:
      beforeInit: "cols_macro.js"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---



```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,	
                      warning = FALSE,
                      eval = FALSE,
                      tidy = FALSE)
library(knitr)
```

class: inverse, center

<div style="text-align: left">
<img style="float: center; margin: 0px 15px 15px 0px;" src="picture/UI.png" width="80" height="100"/>
</div>


## Data Visualization Training (ggplot2)

#### UI LISA<br> Materials: https://fomotis.github.io/ggplot_training/

<div style="text-align: right">
<img style="float: center; margin: 0px 15px 15px 0px;" src="picture/UI_LISA.jpg" width="80" height="100"/>
</div>


---
class: center, middle

# Week one

`Assumptions` <br>

`Grammar of graphics` <br>

`Enters ggplot2` <br>

`Why the fuss about ggplot2?` <br>

---

# Assumptions

1. You have access to internet `r emo::ji("heavy_check_mark")`

2. You have some experience working with `R` `r emo::ji("question")`

3. You like cool graphics `r emo::ji("smile")`

## Desirable but not necessary

1. You have some experience with `tidyverse` and `piping(%>%)` `r emo::ji("+1")`


#### `r emo::ji("cross mark")` assumption 2  `r emo::ji("right arrow")` crash course in `R` and `tidyverse`

#### `r emo::ji("heavy_check_mark")` assumption 2  `r emo::ji("right arrow")` Grammar of graphics

---

# Crash course in `R` and `tidyverse`

---

# Grammar of graphics

.pull-left[
<img src="picture/Hadley-wickham.jpg" width="200" height="300">
]

.pull-right[

* Term coined by `Leland Wilkinson` expanded to layered grammar of graphics by `Hadley Wickham`.

* *"A grammar of graphics is a tool that enables us to concisely describe the components of a graphic. Such a grammar allows us to move beyond named graphics and gain insight into the deep structure that underlies statistical graphics"*.

* The concept is essentially a set of rules that allows us to think of a statistical graphic beyond a certain name and format. 
]

---

# Grammar of graphics 2

* With this tool, you don't have to think about a scatter or box plot, but what set of information should I put on this graph to convey the message I want. 

* A plot is any name you give it. While the elements of the plots are merely verbs.

* To 

```{r}
data("HairEyeColor")
```

.footnote[http://dx.doi.org/10.1198/jcgs.2009.07098]

---

# Enters GGplot2

* base `R` plots can be built based 

---
class: center, middle

# Week two

`Basic ggplot2 functions (ggplot and qplot)` <br>

`Basic plots with ggplot2` <br>

---

# Basic ggplot2 functions

---

# Aesthetics

---

# Basic plots with ggplot2

---
class: center, middle

# Week three

`Legends and Themes customization` <br>

---

# Themes

---

# Available Themes

---

# Customising Themes


---
class: center, middle

# Week four

---

# Week four topic one

---

# Week four topic two

---

# Week four topic three

---
class: center, middle

# Week five

---

# Week five topic one

---

# Week five topic two

---

# Week five topic three



---
class: center, middle

# Week six

---

# Week six topic one

---

# Week six topic two

---

# Week six topic three


---
# Week seven topic one

---
# week seven topic two

---
# week seven topic three

---
class: center, middle

# Week Eight
---


## Proponent(s) of Facets
.pull-left[

* **Facets** were popularised by Edward Tuffe in his 1983 book, *The Visual Display of Quantivative Information*, from a concept of small multiples.
<img src="picture/book_cover.png" width="300" height="300"/>
]

.pull-right[
* The idea is that we can spread up a small part to produce multiple 
smaller parts that have the same cordinate system.

Taking an example of tips per total bill

![](picture/tips.png)
]

---
## **Purpose of Facets**

Faceting helps to split the data up into groups, according to a categorical variable, then plots each group in its own panel.

![](picture/tips2.png)

---
## Install the required packages and load the libraries

install.packages("ggplot2")

install.packages("tidyverse")

library(ggplot2)

library(reshape2)

* Inspect the variables in `tips` data set from `reshape` library
```{r}
names(tips)
head(tips)
str(tips)
```

---
## Formula notation

Faceting splits the data up into groups, according to a categorical variable, 
then plots each group in its own panel. 

For splitting the data by one or two categorical variables, `facet_grid()` is 
used. As well as the `vars()` notation for specifying which variables should
be used to split the dataset into facets.

* To divide by "sex" vertically;-

```{r}
ggplot(tips, aes(x=total_bill, 
                 y=tip/total_bill)) + 
  geom_point(shape=1) + 
  facet_grid(cols = vars(sex)) # or facet_grid(. ~ sex)
```

* To divide by "sex' horizontally;-

```{r}
library(ggplot2)
library(reshape2)
ggplot(tips, aes(x=total_bill, 
                 y=tip/total_bill)) + 
  geom_point(shape=1) + 
  facet_grid(rows = vars(sex)) # or facet_grid(sex ~ .)
```


---
## **Results**
.pull-left[
* To divide by "sex" vertically;-
<img src="picture/tips3.png" style="width:400px;height:300px; center;">

]

.pull-right[
* To divide by "sex" vertically;-
![](picture/tips4.png)
]

---
## **How to Add two categories**
In order to add two categories, both the `rows` and `cols` arguments in `facet_grid` are used.

![](picture/tips5.png)

---
## **Using geom_bar chart**

Using WDI data from the World Bank, population demographics can be categorised as Urban and Rural. Data was obtained from 2015 to 2018 for the Southern Africa countries namely Eswatini, Angola, Botswana, Malawi, South Africa, Mozambique, Zambia , Zimbabwe, Namibia,Lesotho, South Africa, Botswana and Angola.

Using the 'Rural_Urban_lg.csv' file, first inspect the variables in the dataset


```{r}
Rural_Urban_lg <- read.csv("~/UI_LISA/Training_2/ggplot_training/Data/Rural_Urban_lg.csv", 
                          header = TRUE, stringsAsFactors = FALSE)
names(Rural_Urban_lg) # To know the list of all variables 
str(Rural_Urban_lg) # To know the structure of the given variables
head(Rural_Urban_lg) # To know the first 6 rows (observations)
tail(Rural_Urban_lg) # To know the last 6 rows (observations)
```


---
## **Plotting the bar chart**
```{r}
ggplot(Rural_Urban_lg, aes(country, Total_Pop, fill= country)) +
  geom_bar(aes(reorder(country, Total_Pop),Total_Pop),
           stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  facet_grid(Pop_Setting ~ year ,labeller= label_context, 
              scales = "free") +
  geom_text(aes(label= Total_Pop), hjust=-0.1, colour="black",
             size=2.2, angle=90) +
  ylab("Proportion of population (%)") +
  theme(axis.text.x = element_text(angle = 90, hjust =1, vjust=0.2))
```


---
## **Results**
<img src="picture/wb1.png" style="width:700px;height:500px; center;"/>

---
## **Comparing geom_bar with Miscrosoft Excel output**
<img src="picture/Urban_Rural_Proportion.png" style="width:600px;height:500px;"/>

---

## **Using facet_wrap**

```{r}
ggplot(Rural_Urban_lg, aes(country, Total_Pop, fill= country)) +
  geom_bar(aes(reorder(country, Total_Pop),Total_Pop),
           stat= "identity", show.legend = TRUE) +
   geom_text(aes(label= Total_Pop), hjust=-0.2, colour="black",
             size=3, angle=90) +
    scale_fill_brewer(palette = "Paired")+
  ylab("Proportion of population (%)") +
   facet_wrap(Pop_Setting ~ year, nrow = 2, scales = "free") +
   theme(axis.text.x = element_text(angle = 90, hjust =1, vjust=0.2))
```


---
## **Results**
<img src="picture/wb2.png" style="width:800px;height:500px; center;"/>

---
class: center, middle

# Week Nine
---
## **Reordering within the facets**
```{r}
Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(
  x= reorder_within(country, Total_Pop, Pop_Setting), 
           y =Total_Pop, fill= country)) +
  geom_bar(stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(label= Total_Pop), 
            hjust=1, colour="black",size=4, angle=90, fontface= "bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(axis.text.x = element_text(angle = 90, hjust =1, vjust=0.2)) +
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year ,scales = "free", ncol=2)
```


---
## **Results**
<img src="picture/wb3.png" style="width:800px;height:500px; center;"/>


---
## Change the text of facet labels
.pull-left[
You can assign proper labels in your original data before plotting.

The default value is `label_value` which displays only the value

Common alternatives are:

`label_both`: Displays both the value and the variable name
`label_context`: Displays only the values or both the values and variables depending on whether multiple factors are faceted
]

.pull-right[
```{r eval=FALSE}
library(tidyverse)
library(tidytext)
Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(
  x= reorder_within(country, Total_Pop, 
                    Pop_Setting), 
  y =Total_Pop, fill=country)) +
  geom_bar(
    stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(
    label= Total_Pop), hjust=1, colour="black",
    size=4, angle=90,fontface="bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(axis.text.x = element_text(
    angle = 90, hjust =1, vjust=0.2)) +
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year,
             scales = "free", ncol=2, 
             labeller = label_value)
```
]

---
## **Results**
<img src="picture/wb4.png" style="width:800px;height:500px; center;"/>

---
## **Continuation**
```{r eval=FALSE}
Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(
  x= reorder_within(country, Total_Pop, Pop_Setting), 
           y =Total_Pop, fill=country)) +
  geom_bar(stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(label= Total_Pop), 
            hjust=1, colour="black",size=4, angle=90, fontface="bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(axis.text.x = element_text(
    angle = 90, hjust =1, vjust=0.2)) +
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year,
             scales = "free", ncol=2, 
             labeller = label_both)
```

---
## **Results**
<img src="picture/wb5.png" style="width:800px;height:500px; center;"/>

---
## **Renaming facet labels**

```{r eval=FALSE}
Rural_Urban_lg$Pop_Setting <- fct_recode(Rural_Urban_lg$Pop_Setting,
                                Rural_Population = "Rural_Pop",
                                Urban_Population = "Urban_Pop")

Rural_Urban_lg$Pop_Setting = fct_relevel(Rural_Urban_lg$Pop_Setting,
                       c("Rural_Population",
                       "Urban_Population"))

Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(
  x= reorder_within(country, Total_Pop, Pop_Setting), 
                           y =Total_Pop, fill=country)) +
  geom_bar(stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(label= Total_Pop), 
            hjust=1, colour="black",size=4,angle=90, fontface="bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(
    axis.text.x = element_text(
      angle = 90, hjust =1, vjust=0.2))+
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year ,scales = "free", ncol=2, 
             labeller = label_value)
```

---
## **Results**
<img src="picture/wb6.png" style="width:800px;height:500px; center;"/>


---
## **Changing the colour of facet labels**

```{r eval=FALSE}
Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(
  x= reorder_within(country, Total_Pop, Pop_Setting), 
                           y =Total_Pop, fill=country)) +
  geom_bar(stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(label= Total_Pop), 
            hjust=1, colour="black",size=4, angle=90, fontface="bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(axis.text.x = element_text(angle = 90, hjust =1, vjust=0.2),
    strip.text.x = element_text(
      size = 12, color = "darkblue", face = "bold")) +
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year ,scales = "free", 
             labeller = label_value)
```

---
## **Results**
<img src="picture/wb7.png" style="width:800px;height:500px; center;"/>

---
## **Changing the colour of facet labels**
Using the *[sape website](http://sape.inf.usi.ch/quick-reference/ggplot2/colour)*, you can find out the various colours to be used.
```{r eval=FALSE}
Rural_Urban_lg %>% 
  filter(year %in% c("2017", "2018")) %>% 
ggplot(aes(x= reorder_within(
  country, Total_Pop, Pop_Setting), y =Total_Pop, fill=country)) +
  geom_bar(stat= "identity", show.legend = TRUE) +
  scale_fill_brewer(palette = "Paired")+
  geom_text(aes(label= Total_Pop), 
            hjust=1, colour="black",size=4,angle=90, fontface="bold") +
  ylab("Proportion of population (%)") +
  xlab("Countries") +
  theme(axis.text.x = element_text(angle = 90, hjust =1, vjust=0.2),
    strip.text.x = element_text(
      size = 12, color = "darkblue", face = "bold"),
    strip.background = element_rect(
      fill="yellow3", size=1,color="darkblue")) +
  scale_x_reordered()+
  facet_wrap(Pop_Setting ~ year ,scales = "free", 
             labeller = label_value)
```

---
## **Results**
<img src="picture/wb8.png" style="width:800px;height:500px; center;"/>
